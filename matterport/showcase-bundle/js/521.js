/*! For license information please see 521.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[521],{1158:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var n=i(53613),r=i(57956),a=i(53203),l=i(14564),s=i(64210),o=i(26544);const u=async function(e){const t=await e.getModuleBySymbol(r.y.SETTINGS),i=t.addPanel(n.s.TITLE,n.s.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const n="meshtextures";[{panel:i,header:n,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&(0,o.qT)().limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:i,header:n,setting:"textureStreamPause",initialValue:()=>a.ZP.debugPauseTexStream,onChange:e=>{a.ZP.debugPauseTexStream=e},urlParam:!0},{panel:i,header:n,setting:"textureStreamRaycastHits",initialValue:()=>a.ZP.debugLOD,onChange:e=>{a.ZP.debugLOD=e,e||(0,s.d)()},urlParam:!0},{panel:i,header:n,setting:"debugRTTQuality",initialValue:()=>a.ZP.debugRttQuality,onChange:t=>{a.ZP.debugRttQuality=t,t||e.commandBinder.issueCommand(new l.u({color:null},{style:l.u.selectBy.all}))},urlParam:!0},{panel:i,header:n,setting:"debugRTTScores",initialValue:()=>a.ZP.debugRttScores,onChange:t=>{a.ZP.debugRttScores=t,t||e.commandBinder.issueCommand(new l.u({color:null},{style:l.u.selectBy.all}))},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},50447:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>P,tiledMeshDebugMenu:()=>M});var n=i(97998),r=i(57956),a=i(39880),l=i(92558),s=i(69984),o=i(53613),u=i(51524),d=i(53203),c=i(947),g=i(84428),h=i(26544),m=i(35895);function y(e,t=16){let i;const n=(0,m.k1)((()=>i=window.setInterval((()=>e()),t)),(()=>{i&&clearInterval(i)}));return n.cancel(),n}var p=i(59279);const x=new n.Z("tiled-mesh"),T={hideMenu:"1"!==(0,p.eY)("dmenu","0"),debug:"1"===(0,p.eY)("debugTiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!1,statsTextureStream:!1};let b=null;function v(e,t,i){b||(b=document.createElement("div"),b.style.color="#FFFFFF",b.style.fontFamily="Roboto",b.style.fontWeight="300",b.style.fontSize="12px",b.style.position="absolute",b.style.top="50px",b.style.width="500px",b.style.pointerEvents="none",b.style.whiteSpace="pre",b.style.zIndex="99999",b.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(b));let n=T.statsTileset?function(e){var t,i,n;const r=e.tilesRenderer,a=Object.values(null!==(t=r.tileSets)&&void 0!==t?t:[])[0];return`\ntileset: version: ${null==a?void 0:a.asset.tilesetVersion}, depth: ${null===(i=null==a?void 0:a.asset.extras)||void 0===i?void 0:i.depth}, preset: ${null===(n=null==a?void 0:a.asset.extras)||void 0===n?void 0:n.preset}\n`}(e):"";n+=T.statsTiles?function(e,t){const i=e.tilesRenderer,n=i.visibleTiles,r={};n.forEach((e=>{var t;const i=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,n=r[i]||0;r[i]=n+1}));const a=t.threeRenderer.info,{stats:l,downloadQueue:s,parseQueue:o,lruCache:u}=i,{active:d,downloading:c,inFrustum:g,parsing:h,used:m,visible:y}=l;return`\nthree:\n    drawCalls: ${a.render.calls}\n    geometries: ${a.memory.geometries}\n    textures: ${a.memory.textures}\n    triangles: ${a.render.triangles}\n    memory allocated (megs): ${Math.floor(t.estimatedGPUMemoryAllocated()/2**20)}\ntiles:\n    tiles in frustum: ${g}\n    visible: ${y}`+Object.keys(r).sort().map((e=>`\n     ${e} tiles: ${r[e]||0}`)).join()+`\n    downloading gltf: ${c}\n    parsing gltf: ${h}\n    active: ${d}\n    used: ${m}\n    queues:\n      download: ${s.currJobs} running, ${s.items.length} waiting\n      parse: ${o.currJobs} running, ${o.items.length} waiting\n    lruCache: ${u.itemSet.size}\n`}(e,i):"",n+=T.statsTextureStream?function(e){const t="downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return`textureStreaming:\n    downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n    downloadingTextures: ${e.loadingTextures}\n`+t}(t):"",b.textContent=n}let S=null;async function M(e){if(!T.debug)return;const t=await e.getModuleBySymbol(r.y.SETTINGS),i=await e.getModuleBySymbol(r.y.INPUT),n=await e.getModuleBySymbol(r.y.WEBGL_RENDERER),c=n.getScene(),g=await e.getModuleBySymbol(r.y.MODEL_MESH),m=g.modelTextureLoader,p=g.modelMesh.tileLoader,b=t.tryGetProperty(d.iT,!1);function M(){S||(S=setInterval((()=>v(p,m,n)),150))}const f=t.addPanel(o.s.TITLE,o.s.HOTKEYS,{width:350}),P={viz:"visualize",stats:"stats",tile:"tileset",log:"log"},O=function(e,t,i,n,r){const a=w(i,r,((e,t)=>e.setWireframe(t))),o=function(e,t){const i={scale:1},n=(t,n)=>{if(!t)return;const r=e.container.tilesByChunkId.get(t.id),a=(null==r?void 0:r.__error)||1e-4,l=t.lod!==u.t.maxLOD&&a>u.t.errorTarget?1:.5,s=Math.max(0,Math.min(1,1-i.scale/a)),o=n?C(t.lod,s,l):null;t.setColorOverlay(o)},r=w(e,t,n),a=y((()=>r.colorize(e.container.chunks)));return{toggle:e=>{e?a.renew():a.cancel(),r.toggle(e)},colorize:r.colorize,subscription:a,config:i}}(i,r),d=w(i,r,((e,t)=>{e.setColorOverlay(t?C(e.lod,1,.5):null)})),c=w(i,r,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.id||0):null)})),g=w(i,r,((e,t)=>{var n;const r=i.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,s.G1)(.5,(0,l.un)((null===(n=null==r?void 0:r.content)||void 0===n?void 0:n.uri)||"missing")||0):null)})),m=w(i,r,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),p=w(i,r,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.meshSubgroup||0):null)})),T=w(i,r,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.meshGroup||0):null)})),b=w(i,r,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,(0,l.un)(e.textureName)||0):null)})),v=w(i,r,((e,t)=>{const n=i.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,s.G1)(.5,(null==n?void 0:n.geometricError)||0):null)})),S=n.slots,M=(0,h.qT)(),f=w(i,r,((e,t)=>{const i=S.find((t=>t.textureName===e.textureName));if(i){const n=i.loading?1:i.quality>M.min(e.lod)?.7:.3,r=M.maxTexelSize/M.get(i.quality).texelSize;e.setColorOverlay(t?C(e.lod,r,n):null)}})),P=y((()=>f.colorize(i.container.chunks)));let O="none";const V={none:void 0,byError:o,byGeometricError:v,byTile:g,bySubgroup:p,byMeshgroup:T,bySubAndMeshgroup:m,byTexture:b,byStreamedTextures:{subscription:P,toggle:e=>{e?P.renew():P.cancel(),e&&x.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),f.toggle(e)}},byChunk:c,byLod:d};return[{panel:e,header:t.viz,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.viz,setting:"wireframe",initialValue:()=>!1,onChange:a.toggle,urlParam:!0},{panel:e,header:t.viz,setting:"colorize",initialValue:()=>"none",onChange:e=>{var t,i;null===(t=V[O])||void 0===t||t.toggle(!1),null===(i=V[e])||void 0===i||i.toggle(!0),O=e},options:Object.keys(V),urlParam:!0},{panel:e,header:t.viz,setting:"colorizeByErrorScale",initialValue:()=>1,onChange:e=>{o.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}]}(f,P,p,m,e),V=[{panel:f,header:P.stats,setting:"tilesetStatsOverlay",initialValue:()=>T.statsTileset,onChange:e=>{T.statsTileset=e,e&&M()},urlParam:!0},{panel:f,header:P.stats,setting:"tileStatsOverlay",initialValue:()=>T.statsTiles,onChange:e=>{T.statsTiles=e,e&&M()},urlParam:!0},{panel:f,header:P.stats,setting:"textureStatsOverlay",initialValue:()=>T.statsTextures,onChange:e=>{T.statsTextures=e,e&&M()},urlParam:!0},{panel:f,header:P.stats,setting:"textureStreamingOverlay",initialValue:()=>T.statsTextureStream,onChange:e=>{T.statsTextureStream=e,e&&M()},urlParam:!0}],E=[{panel:f,header:P.log,buttonName:"Log: App State",callback:()=>{x.warn(g),x.warn(i),x.warn(c),x.warn(t)}}];b&&(T.hideMenu||await(0,a.gw)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,a.gw)(16),O.forEach((e=>t.registerMenuEntry(e))),await(0,a.gw)(16),function(e,t){return[{panel:e,header:t.tile,setting:"maxLOD",initialValue:()=>u.t.maxLOD,onChange:e=>{u.t.maxLOD=e},range:[0,3],rangePrecision:0,urlParam:!0},{panel:e,header:t.tile,setting:"errorTarget",initialValue:()=>u.t.errorTarget,onChange:e=>{u.t.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>u.t.displayActiveTiles,onChange:e=>{u.t.displayActiveTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>u.t.loadSiblings,onChange:e=>{u.t.loadSiblings=e},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>u.t.autoDisableRendererCulling,onChange:e=>{u.t.autoDisableRendererCulling=e},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>u.t.stopAtEmptyTiles,onChange:e=>{u.t.stopAtEmptyTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.tile,setting:"disposeModel",initialValue:()=>u.t.disposeModel,onChange:e=>{u.t.disposeModel=e},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>u.t.limitMemoryUsage,onChange:e=>{u.t.limitMemoryUsage=e},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>u.t.allocatedMegsBeforeLimitingLod,onChange:e=>{u.t.allocatedMegsBeforeLimitingLod=e},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>u.t.lruMinExtraTiles,onChange:e=>{u.t.lruMinExtraTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>u.t.lruMaxTiles,onChange:e=>{u.t.lruMaxTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>u.t.lruUnloadPercent,onChange:e=>{u.t.lruUnloadPercent=e},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>u.t.errorMultiplierRaycastOcclusion,onChange:e=>{u.t.errorMultiplierRaycastOcclusion=e},urlParam:!0,range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>u.t.errorMultiplierHiddenFloors,onChange:e=>{u.t.errorMultiplierHiddenFloors=e},urlParam:!0,range:[.001,1],rangePrecision:2}]}(f,P).forEach((e=>t.registerMenuEntry(e))),V.forEach((e=>t.registerMenuEntry(e))),E.forEach((e=>t.registerMenuButton(e))))}function w(e,t,i){let n=!1;const r=e=>{t.after(c.A.End).then((()=>{e.forEach((e=>{e&&i(e,n)}))}))},a=e.notifyOnChunksLoaded(r);a.cancel();return{toggle:t=>{t?a.renew():a.cancel(),t!==n&&(n=t,r([...e.container.chunks]))},colorize:r,subscription:a}}const f={0:new g.Vector4(1,0,0,1),1:new g.Vector4(0,1,0,1),2:new g.Vector4(0,0,1,1),3:new g.Vector4(1,1,1,1),4:new g.Vector4(1,0,1,1),5:new g.Vector4(0,1,1,1),6:new g.Vector4(1,1,0,1),7:new g.Vector4(0,0,0,1)};function C(e,t,i){var n,r;const a=null!==(r=null===(n=f[e])||void 0===n?void 0:n.clone())&&void 0!==r?r:new g.Vector4;return a.multiplyScalar(t),a.setW(i),a}const P=M},53613:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});const n={TITLE:"streamed-mesh (T)",HOTKEYS:[i(32597).R.T]}},14564:(e,t,i)=>{"use strict";i.d(t,{u:()=>l});var n,r,a=i(19663);!function(e){e.all="all",e.byMeshGroup="byMeshGroup",e.byMeshSubGroup="byMeshSubGroup"}(n||(n={})),function(e){e.explicit="explicit",e.random="random"}(r||(r={}));class l extends a.m{constructor(e,t){super(),this.id="SET_MESH_OVERLAY_COLOR",this.payload={selectBy:(null==t?void 0:t.style)||n.all,colorStyle:(null==e?void 0:e.style)||r.explicit,color:(null==e?void 0:e.color)||null,alpha:(null==e?void 0:e.alpha)||.5,index:null==t?void 0:t.index}}}l.selectBy=n,l.colorBy=r,l.COLOR_DIM={x:0,y:0,z:0,w:.3}},21270:(e,t,i)=>{"use strict";var n;i.d(t,{V:()=>n}),function(e){e[e.Min=0]="Min",e[e.Standard=1]="Standard",e[e.High=2]="High",e[e.Detail=3]="Detail"}(n||(n={}))},51524:(e,t,i)=>{"use strict";i.d(t,{t:()=>s});var n=i(59279),r=i(53261),a=i(31362),l=i(21270);const s={urlTemplateToken:"<file>",initialMaxLOD:l.V.Min,nonMeshMaxLOD:l.V.Standard,maxLOD:l.V.High,loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,errorTarget:Number((0,n.eY)("errorTarget",(0,a.tq)()?6:4)),disableTileUpdates:!1,errorMultiplierRaycastOcclusion:.1,errorMultiplierHiddenFloors:.01,disposeModel:!1,limitMemoryUsage:(0,a.tq)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,a.tq)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,tileAssetRequestPriority:r.ru.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:l.V.Standard}},26544:(e,t,i)=>{"use strict";i.d(t,{O7:()=>y,qT:()=>h});var n=i(69984),r=i(84428),a=i(21270),l=i(99935),s=i(2569),o=i(53203);class u{constructor(){this._configs={},this._orders={},this._maxLod=-1/0,this._maxTs=1/0,this._streamAbove=0,this.resetOnNextRegisterOnce=!1,this.dynamic=!1}static encodeKey(e,t){return e-t}get maxLod(){return this._maxLod}get maxTexelSize(){return this._maxTs}limitStreamingBelow(e){this._streamAbove=e}order(e,t=!1){return t&&!this._orders[e]&&(this._orders[e]=[]),this._orders[e]}reset(){this._configs={},this._orders={},this.dynamic=!1,this._maxTs=1/0,this._maxLod=-1/0}get isDynamic(){return this.dynamic}valid(e){return e in this._configs}get(e){if(!this.valid(e))throw new Error("invalid quality level "+e);return this._configs[e]}max(e){return e<this._streamAbove?this.min(e):this.order(e)[this.order(e).length-1]}min(e){return this.order(e)[0]}fromPixelSize(e,t){const i=this.order(e),n=this.min(e);let r=this.max(e);for(let e=i.length-1;e>=0;e--)t>this.get(i[e]).texelSize&&i.indexOf(r)>i.indexOf(n)&&(r=i[e]);return r}moreDetailed(e,t){let i=this.min(e);const n=this.max(e),r=this.order(e),a=r.indexOf(t);return a+1===r.length?n:(-1!==a&&(i=Math.min(n,r[a+1%r.length])),i)}lessDetailed(e,t){const i=this.order(e),n=i.indexOf(t);let r=t;return-1!==n&&(r=i[Math.max(0,n-1)]),r}minSize(){return Object.values(this._configs).sort(d)[0]}maxSize(){const e=Object.values(this._configs).sort(d);return e[e.length-1]}nearestQuality(e,t){const i=this.order(e),n=this.max(e),r=(0,s.et)(t,1,4,0,i.length-1);return Math.min(n,i[Math.round(r)])}registerQualities(e,t,i,n,r="max"){this.dynamic=!0,this.resetOnNextRegisterOnce&&(this.reset(),this.resetOnNextRegisterOnce=!1);const a=this._configs,l=this.order(e,!0),s=t*n;for(let n=t,d=i;n>=s;n*=.5,d*=2){const i=u.encodeKey(e,d),s=a[i];(!s||s&&s.assetSize<t)&&(this._maxTs=Math.min(this._maxTs,d),this._maxLod=Math.max(this._maxLod,e),a[i]={key:i,lod:e,texelSize:d,textureSize:n,assetSize:t,assetType:r,tileSize:Math.min(n,o.ZP.textureTileSize)}),-1===l.indexOf(i)&&l.push(i)}l.sort(((e,t)=>a[t].texelSize-a[e].texelSize))}}function d(e,t){return e.textureSize>t.textureSize?1:-1}const c=new u;var g;(g=c).reset(),g.registerQualities(a.V.Standard,512,.048,.5,"low"),g.registerQualities(a.V.Standard,2048,.012,.5,"high"),g.dynamic=!1,g.resetOnNextRegisterOnce=!0;const h=()=>c;const m={[l.S.LOW]:new r.Vector4(1,0,0,.5),[l.S.MEDIUM]:new r.Vector4(1,1,0,.5),[l.S.HIGH]:new r.Vector4(0,1,0,.5),[l.S.ULTRA]:new r.Vector4(0,1,1,.5)};function y(e){return e in m?m[e]:(0,n.G1)(.5,e)}},64210:(e,t,i)=>{"use strict";i.d(t,{e:()=>o,d:()=>u});var n=i(84428);const r=i(53203).ZP.sightingMaxAge,a=new n.Color;let l,s=-1;const o=(e,t)=>{l||(l=new n.InstancedMesh(new n.SphereGeometry(.005,8,4),new n.MeshBasicMaterial,r),d(l));const i=new n.Matrix4;return({point:n,distance:o})=>{i.makeScale(o,o,o).setPosition(n),l.setMatrixAt(++s%r,i),l.instanceMatrix.needsUpdate=!0;for(let t=r;t--;)l.setColorAt((s-t+r)%r,a.set(e).multiplyScalar(1-t/r));l.instanceColor&&(l.instanceColor.needsUpdate=!0),l.parent||t.scene.add(l)}},u=()=>{var e;l&&(null===(e=l.parent)||void 0===e||e.remove(l),d(l))};function d(e){const t=(new n.Matrix4).makeScale(0,0,0);for(let i=0;i<r;i++)e.setMatrixAt(i,t)}},69984:(e,t,i)=>{"use strict";i.d(t,{G1:()=>s,rn:()=>o,D5:()=>u,Ex:()=>d});var n=i(84428),r=i(39880);const a=()=>Math.random(),l={},s=(e,t=a())=>(l[t]||(l[t]=new n.Vector4(a(),a(),a(),e)),l[t]),o=()=>new n.Color(a(),a(),a()),u=e=>"object"==typeof e&&"r"in e&&"g"in e&&"b"in e;function d(e){return`#${(0,r.Q_)(255*e.r,2,"0",16)}${(0,r.Q_)(255*e.g,2,"0",16)}${(0,r.Q_)(255*e.b,2,"0",16)}`}}}]);